<!doctype html>

<html lang="en">

<head>
  <meta charset="utf-8">

  <title>ccNetViz</title>
  <meta name="description" content="">
  <style>
    #graph {
      width: 100%;
      height: 400px;
    }
  </style>
  <script src="static/js/ccNetViz.js"></script>
  <script type="text/javascript">
    window.addEventListener('load', function () {
      const width = document.getElementById("graph").offsetWidth;
      const height = document.getElementById("graph").offsetHeight;
      const c = document.getElementById("ccnetviz");

      const nodes = [];
      const edges = [];

      const lineSpace = 0.03;
      const lineHeight = 0.03;
      const deflectionRatio = 0.06;
      const cursor = 0;
      var nodeMap = {};

      function randomNumber(min, max) {
        return Math.ceil(Math.random() * (max - min) + min);
      }

      c.setAttribute("width", width);
      c.setAttribute("height", height);

      // Creating nodes
      var x = 0;
      for (var column = 0; ; column) {
        if (x + lineSpace >= 0.98) {
          break;
        }
        for (let cursor = 0; cursor < 1;) {
          if (typeof nodeMap[column] !== "undefined") {
            nodeMap[column] = nodeMap[column] + 1;
          } else {
            nodeMap[column] = 0;
          }

          x = (lineSpace * column) + (deflectionRatio / randomNumber(1, 5));

          nodes.push({
            label: `Node`,
            x: x,
            y: cursor
          });

          cursor += lineHeight + (deflectionRatio / randomNumber(1, 3));
        }
        column += 1;
      }

      // Set the edges
      var nodeIndex = 0;
      for (let index in nodeMap) {
        const column = nodeMap[index];
        for (let j = 0; j < column; j++) {
          if (index > 0) {
            const count = nodeMap[index - 1];
            let sourceNode = nodes[nodeIndex + 1];
            let targetNode = nodes[nodeIndex - count];

            if (nodeMap[index - 1] >= nodeMap[index]) {
              // Node rank 2
              edges.push({
                source: sourceNode,
                target: targetNode
              });

              // Node rank 3,4 possibility
              if (randomNumber(1, 5) === 3) {
                sourceNode = nodes[nodeIndex];
                targetNode = nodes[nodeIndex - count];

                edges.push({
                  source: sourceNode,
                  target: targetNode
                });
              }

              // Multiple edges possibility
              if (randomNumber(1, 10) === 3) {
                edges.push({
                  source: targetNode,
                  target: sourceNode
                });
              }

              // TODO : Workaround
              if (j === 0) {
                sourceNode = nodes[nodeIndex];
                targetNode = nodes[nodeIndex - count - 1];
                edges.push({
                  source: targetNode,
                  target: sourceNode
                });
              }
            } else {
              if (j !== nodeMap[index - 1])
                edges.push({
                  source: sourceNode,
                  target: targetNode
                });
            }
          }

          let sourceNode = nodes[nodeIndex];
          let targetNode = nodes[nodeIndex + 1];

          if ((j + 1 === column)) {
            nodeIndex++
          }

          edges.push({
            source: sourceNode,
            target: targetNode
          });

          // Multiple edge possibility
          if (randomNumber(1, 5) === 3) {
            edges.push({
              source: targetNode,
              target: sourceNode
            });
          }
          nodeIndex++;
        }
      }

      // Drawing graph
      const graph = new ccNetViz(c, {
        styles: {
          background: {
            color: "rgb(0, 0, 0)"
          },
          node: {
            texture: "./images/circle.png",
            label: {
              hideSize: 16
            },
            color: "rgb(140, 140, 140)"
          },
          ccNetViz: {
            color: "rgb(240, 240, 240)"
          },
          edge: {
            color: "rgb(140, 140, 140)"
          }
        }
      });

      const _c = [
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 1, 1, 1, 0, 0, 0],
        [0, 0, 1, 1, 1, 1, 1, 1, 1, 0],
        [0, 0, 1, 1, 0, 0, 0, 1, 1, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 0, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 0, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 0, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 0, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 1, 1, 0, 0, 0, 1, 1, 0],
        [0, 0, 1, 1, 1, 1, 1, 1, 1, 0],
        [0, 0, 0, 0, 1, 1, 1, 0, 0, 0]
      ];

      const _n = [
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0],
        [0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0],
        [0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0]
      ];

      const _e = [
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],
        [0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0],
        [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0],
        [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
        [0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0],
        [0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],
      ];

      const _t = [
        [0, 0, 0, 0, 0, 0],
        [0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0],
        [0, 1, 1, 1, 1, 0],
        [0, 1, 1, 1, 1, 0],
        [0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 1, 0],
        [0, 0, 0, 1, 1, 0]
      ];

      const _v = [
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0],
        [0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0],
        [0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0],
        [0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0],
        [0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0],
        [0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0],
        [0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0],
      ];

      const _i = [
        [0, 1, 1, 0],
        [0, 1, 1, 0],
        [0, 0, 0, 0],
        [0, 0, 0, 0],
        [0, 1, 1, 0],
        [0, 1, 1, 0],
        [0, 1, 1, 0],
        [0, 1, 1, 0],
        [0, 1, 1, 0],
        [0, 1, 1, 0],
        [0, 1, 1, 0],
        [0, 1, 1, 0],
        [0, 1, 1, 0],
        [0, 1, 1, 0],
        [0, 1, 1, 0]
      ];

      const _z = [
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
        [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
        [0, 0, 0, 0, 0, 0, 1, 1, 0, 0],
        [0, 0, 0, 0, 0, 1, 1, 0, 0, 0],
        [0, 0, 0, 0, 0, 1, 1, 0, 0, 0],
        [0, 0, 0, 0, 1, 1, 0, 0, 0, 0],
        [0, 0, 0, 1, 1, 0, 0, 0, 0, 0],
        [0, 0, 0, 1, 1, 0, 0, 0, 0, 0],
        [0, 0, 1, 1, 0, 0, 0, 0, 0, 0],
        [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
        [0, 1, 1, 1, 1, 1, 1, 1, 1, 0]
      ];

      function transpose(arr) {
        return arr.map((col, i) => arr.map(row => row[i]));
      }


      var text = [_c, _c, _n, _e, _t, _v, _i, _z];

      const nodeCount = text.map(item => { return item[0].length }).reduce(function (a, b) { return a + b }, 0);

      text = text.map(item => { return transpose(item) });

      const NODE = {
        LINE_SPACE: 0.02,
        SPACE: 0.007
      };

      const textNodeList = [];
      let xCursor = (1 - (nodeCount * NODE.SPACE)) / 2;
      for (let i = 0; i < text.length; i++) {
        const letter = text[i];

        for (let j = 0; j < letter.length; j++) {
          const element = letter[j];
          let y = (1 - (15 * NODE.LINE_SPACE));

          if (typeof letter[j][0] === "undefined") {
            break;
          }

          for (let k = 0; k < element.length; k++) {
            const row = element[k];
            if (row === 1) {
              textNodeList.push({
                x: xCursor,
                y: y,
                style: "ccNetViz"
              })
            }
            y = y - NODE.LINE_SPACE;
          }
          xCursor = xCursor + NODE.SPACE;
        }
      }

      graph.set(nodes.concat(nodes, textNodeList), edges);
      document.getElementById("stats").innerText = `${nodes.length} Nodes, ${edges.length} Edges`;

      graph.draw();
    }, false);
  </script>
</head>

<body>
  <div id="graph">
    <canvas id="ccnetviz"></canvas>
    <div id="stats"></div>
  </div>
</body>